<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0a192f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Expense Tracker">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Expense Tracker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow-x: hidden;
      position: fixed;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: #000;
      color: white;
      position: relative;
      touch-action: pan-y;
      overscroll-behavior: none;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(ellipse at 15% 25%, rgba(6, 182, 212, 0.6) 0%, transparent 30%),
        radial-gradient(ellipse at 85% 20%, rgba(168, 85, 247, 0.5) 0%, transparent 35%),
        radial-gradient(ellipse at 50% 45%, rgba(245, 158, 11, 0.4) 0%, transparent 40%),
        radial-gradient(ellipse at 25% 75%, rgba(59, 130, 246, 0.5) 0%, transparent 38%),
        radial-gradient(ellipse at 75% 80%, rgba(236, 72, 153, 0.4) 0%, transparent 32%);
      background-color: #000814;
      z-index: 0;
    }

    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        radial-gradient(2px 2px at 20px 30px, white, transparent),
        radial-gradient(2px 2px at 60px 70px, white, transparent),
        radial-gradient(1px 1px at 50px 50px, white, transparent),
        radial-gradient(1px 1px at 130px 80px, white, transparent),
        radial-gradient(2px 2px at 90px 10px, white, transparent);
      background-size: 300px 200px;
      background-position: 0 0, 40px 60px;
      opacity: 0.6;
      z-index: 1;
      pointer-events: none;
    }

    .app-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      overflow-x: hidden;
      z-index: 2;
      -webkit-overflow-scrolling: touch;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 16px;
      padding-top: max(16px, env(safe-area-inset-top));
      padding-bottom: calc(100px + env(safe-area-inset-bottom));
    }

    .app-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .app-name {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #06b6d4 0%, #a855f7 50%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 4px;
      cursor: pointer;
      display: inline-block;
      padding: 8px 16px;
      border-radius: 12px;
      user-select: none;
    }

    .app-name:active {
      transform: scale(0.95);
    }

    .app-subtitle {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 500;
    }

    .profile-section {
      text-align: center;
      margin-bottom: 24px;
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 50%, #a855f7 100%);
      margin: 0 auto 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      font-weight: bold;
      color: white;
      box-shadow: 0 0 30px rgba(6, 182, 212, 0.5);
      cursor: pointer;
      overflow: hidden;
      border: 3px solid rgba(255, 255, 255, 0.2);
      user-select: none;
    }

    .profile-avatar:active {
      transform: scale(0.95);
    }

    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    .profile-name {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      cursor: pointer;
      display: inline-block;
      padding: 6px 16px;
      border-radius: 8px;
      user-select: none;
    }

    .profile-name:active {
      transform: scale(0.95);
    }

    #photoInput {
      display: none;
    }

    .total-card {
      background: linear-gradient(135deg, 
        rgba(6, 182, 212, 0.15) 0%, 
        rgba(59, 130, 246, 0.15) 35%,
        rgba(168, 85, 247, 0.15) 70%,
        rgba(245, 158, 11, 0.15) 100%);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(255, 255, 255, 0.1);
      padding: 24px;
      border-radius: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .total-label {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 6px;
      font-weight: 600;
    }

    .total-amount {
      font-size: 40px;
      font-weight: 700;
      margin-bottom: 18px;
      background: linear-gradient(135deg, #06b6d4 0%, #f59e0b 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .total-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .total-actions button,
    .total-actions select {
      flex: 1;
      min-width: calc(50% - 5px);
      padding: 12px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }

    .total-actions button:active,
    .total-actions select:active {
      transform: scale(0.95);
      background: rgba(255, 255, 255, 0.2);
    }

    .categories-section {
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
      color: rgba(255, 255, 255, 0.95);
    }

    .categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      margin-bottom: 20px;
    }

    .category-card {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.15);
      padding: 14px;
      border-radius: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }

    .category-card:active {
      transform: scale(0.95);
    }

    .category-card.active {
      background: linear-gradient(135deg, rgba(6, 182, 212, 0.3) 0%, rgba(168, 85, 247, 0.3) 100%);
      border-color: rgba(6, 182, 212, 0.5);
      box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
    }

    .category-icon {
      font-size: 32px;
      margin-bottom: 6px;
    }

    .category-name {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 4px;
      font-weight: 600;
    }

    .category-amount {
      font-size: 13px;
      font-weight: 700;
      color: #06b6d4;
    }

    .expenses-section {
      margin-bottom: 24px;
    }

    .no-expenses {
      text-align: center;
      padding: 40px 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      border: 2px dashed rgba(255, 255, 255, 0.2);
    }

    .no-expenses p:first-child {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .no-expenses p:last-child {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
    }

    .expense-item {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.1);
      padding: 16px;
      border-radius: 16px;
      margin-bottom: 10px;
    }

    .expense-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .expense-amount {
      font-size: 22px;
      font-weight: 700;
      color: #06b6d4;
      display: block;
      margin-bottom: 4px;
    }

    .expense-category {
      display: inline-block;
      background: rgba(6, 182, 212, 0.2);
      color: #06b6d4;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      border: 1px solid rgba(6, 182, 212, 0.3);
    }

    .delete-btn {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #ef4444;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s;
      user-select: none;
    }

    .delete-btn:active {
      transform: scale(0.9);
      background: rgba(239, 68, 68, 0.3);
    }

    .expense-desc {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 8px;
      font-weight: 500;
    }

    .expense-meta {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 4px;
    }

    .fab {
      position: fixed;
      bottom: calc(20px + env(safe-area-inset-bottom));
      right: 20px;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%);
      color: white;
      border: none;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(6, 182, 212, 0.5), 0 8px 40px rgba(168, 85, 247, 0.3);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      user-select: none;
    }

    .fab:active {
      transform: scale(0.9);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
      padding-bottom: env(safe-area-inset-bottom);
    }

    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: linear-gradient(135deg, 
        rgba(10, 25, 47, 0.98) 0%,
        rgba(17, 24, 39, 0.98) 100%);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(255, 255, 255, 0.15);
      padding: 24px;
      border-radius: 24px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 22px;
      font-weight: 700;
      background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .close-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: white;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.2s;
      user-select: none;
    }

    .close-btn:active {
      transform: scale(0.9);
      background: rgba(255, 255, 255, 0.2);
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 6px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: white;
      font-size: 15px;
      transition: all 0.2s;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: #06b6d4;
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }

    .form-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .btn-primary,
    .btn-secondary {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      user-select: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
    }

    .btn-primary:active {
      transform: scale(0.95);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: white;
    }

    .btn-secondary:active {
      transform: scale(0.95);
      background: rgba(255, 255, 255, 0.15);
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="container">
      <div class="app-header">
        <div class="app-name" id="appNameBtn" onclick="editAppName()">üí∞ Expense Tracker</div>
        <div class="app-subtitle">Track your spending journey</div>
      </div>

      <div class="profile-section">
        <div class="profile-avatar" id="profileAvatar" onclick="uploadPhoto()">
          <div id="avatarText">?</div>
        </div>
        <input type="file" id="photoInput" accept="image/*" onchange="handlePhotoUpload(event)">
        <div class="profile-name" id="profileName" onclick="editName()">Tap to set your name</div>
      </div>

      <div class="total-card">
        <div class="total-label">Total Expenses</div>
        <div class="total-amount" id="totalAmount">‚Çπ0.00</div>
        <div class="total-actions">
          <select id="filterCategory" class="form-select" onchange="filterExpenses()">
            <option value="All">All Categories</option>
            <option value="Food">üçî Food</option>
            <option value="Transport">üöó Transport</option>
            <option value="Entertainment">üé¨ Entertainment</option>
            <option value="Utilities">üí° Utilities</option>
            <option value="Shopping">üõçÔ∏è Shopping</option>
            <option value="Healthcare">‚öïÔ∏è Healthcare</option>
            <option value="Other">üì¶ Other</option>
          </select>
          <button onclick="exportToExcel()">üìä Export</button>
        </div>
      </div>

      <div class="categories-section">
        <div class="section-title">Categories</div>
        <div class="categories-grid" id="categoriesGrid"></div>
      </div>

      <div class="expenses-section">
        <div class="section-title">Recent Expenses</div>
        <div id="expensesList"></div>
      </div>
    </div>
  </div>

  <button class="fab" onclick="showAddExpenseModal()">+</button>

  <div class="modal" id="addExpenseModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Add Expense</div>
        <button class="close-btn" onclick="closeAddExpenseModal()">√ó</button>
      </div>
      <form id="expenseForm" onsubmit="addExpense(event)">
        <div class="form-group">
          <label class="form-label">Amount (‚Çπ)</label>
          <input type="number" id="inputAmount" class="form-input" step="0.01" required>
        </div>
        <div class="form-group">
          <label class="form-label">Category</label>
          <select id="inputCategory" class="form-select" required onchange="toggleCustomCategory()">
            <option value="">Select Category</option>
            <option value="Food">üçî Food</option>
            <option value="Transport">üöó Transport</option>
            <option value="Entertainment">üé¨ Entertainment</option>
            <option value="Utilities">üí° Utilities</option>
            <option value="Shopping">üõçÔ∏è Shopping</option>
            <option value="Healthcare">‚öïÔ∏è Healthcare</option>
            <option value="Other">üì¶ Other</option>
          </select>
        </div>
        <div class="form-group hidden" id="customCategoryGroup">
          <label class="form-label">Custom Category</label>
          <input type="text" id="inputCustomCategory" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea id="inputDescription" class="form-textarea" required></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Date</label>
          <input type="date" id="inputDate" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label">Payment Method</label>
          <select id="inputPaymentMethod" class="form-select" required onchange="toggleTransactionId()">
            <option value="">Select Method</option>
            <option value="Cash">üíµ Cash</option>
            <option value="Card">üí≥ Card</option>
            <option value="UPI">üì± UPI</option>
            <option value="Net Banking">üè¶ Net Banking</option>
          </select>
        </div>
        <div class="form-group hidden" id="transactionIdGroup">
          <label class="form-label">Transaction ID (Optional)</label>
          <input type="text" id="inputTransactionId" class="form-input">
        </div>
        <div class="form-actions">
          <button type="button" class="btn-secondary" onclick="closeAddExpenseModal()">Cancel</button>
          <button type="submit" class="btn-primary">Add Expense</button>
        </div>
      </form>
    </div>
  </div>

  <div class="modal" id="nameModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Edit Name</div>
        <button class="close-btn" onclick="closeNameModal()">√ó</button>
      </div>
      <div class="form-group">
        <label class="form-label">Your Name</label>
        <input type="text" id="inputName" class="form-input" placeholder="Enter your name">
      </div>
      <div class="form-actions">
        <button class="btn-secondary" onclick="closeNameModal()">Cancel</button>
        <button class="btn-primary" onclick="saveName()">Save</button>
      </div>
    </div>
  </div>

  <div class="modal" id="appNameModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Edit App Name</div>
        <button class="close-btn" onclick="closeAppNameModal()">√ó</button>
      </div>
      <div class="form-group">
        <label class="form-label">App Name</label>
        <input type="text" id="inputAppName" class="form-input" placeholder="Enter app name">
      </div>
      <div class="form-actions">
        <button class="btn-secondary" onclick="closeAppNameModal()">Cancel</button>
        <button class="btn-primary" onclick="saveAppName()">Save</button>
      </div>
    </div>
  </div>

  <script>
    let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
    let userProfile = JSON.parse(localStorage.getItem('userProfile')) || { name: '', photo: '' };
    let appName = localStorage.getItem('appName') || 'üí∞ Expense Tracker';
    let currentFilter = 'All';

    const categoryIcons = {
      'Food': 'üçî',
      'Transport': 'üöó',
      'Entertainment': 'üé¨',
      'Utilities': 'üí°',
      'Shopping': 'üõçÔ∏è',
      'Healthcare': '‚öïÔ∏è',
      'Other': 'üì¶'
    };

    function init() {
      document.getElementById('inputDate').valueAsDate = new Date();
      document.querySelector('#appNameBtn').textContent = appName;
      updateProfile();
      renderExpenses();
      renderCategories();
      
      document.addEventListener('click', (e) => {
        if (e.target.closest('.category-card')) {
          const category = e.target.closest('.category-card').dataset.category;
          filterByCategory(category);
        }
        if (e.target.closest('.delete-btn')) {
          const id = parseInt(e.target.closest('.delete-btn').dataset.id);
          deleteExpense(id);
        }
      });
    }

    function editAppName() {
      document.getElementById('inputAppName').value = appName;
      document.getElementById('appNameModal').classList.add('show');
    }

    function closeAppNameModal() {
      document.getElementById('appNameModal').classList.remove('show');
    }

    function saveAppName() {
      appName = document.getElementById('inputAppName').value || 'üí∞ Expense Tracker';
      localStorage.setItem('appName', appName);
      document.querySelector('#appNameBtn').textContent = appName;
      closeAppNameModal();
    }

    function uploadPhoto() {
      document.getElementById('photoInput').click();
    }

    function handlePhotoUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          userProfile.photo = e.target.result;
          localStorage.setItem('userProfile', JSON.stringify(userProfile));
          updateProfile();
        };
        reader.readAsDataURL(file);
      }
    }

    function updateProfile() {
      const avatarText = document.getElementById('avatarText');
      const name = document.getElementById('profileName');

      if (userProfile.photo) {
        avatarText.innerHTML = `<img src="${userProfile.photo}" alt="Profile">`;
      } else if (userProfile.name) {
        avatarText.textContent = userProfile.name.charAt(0).toUpperCase();
      } else {
        avatarText.textContent = '?';
      }

      if (userProfile.name) {
        name.textContent = userProfile.name;
      } else {
        name.textContent = 'Tap to set your name';
      }
    }

    function editName() {
      document.getElementById('inputName').value = userProfile.name;
      document.getElementById('nameModal').classList.add('show');
      setTimeout(() => document.getElementById('inputName').focus(), 100);
    }

    function closeNameModal() {
      document.getElementById('nameModal').classList.remove('show');
    }

    function saveName() {
      userProfile.name = document.getElementById('inputName').value;
      localStorage.setItem('userProfile', JSON.stringify(userProfile));
      updateProfile();
      closeNameModal();
    }

    function renderCategories() {
      const categories = ['Food', 'Transport', 'Entertainment', 'Utilities', 'Shopping', 'Healthcare', 'Other'];
      const categoryTotals = {};
      
      categories.forEach(cat => {
        categoryTotals[cat] = expenses
          .filter(e => e.category === cat)
          .reduce((sum, e) => sum + e.amount, 0);
      });

      const grid = document.getElementById('categoriesGrid');
      grid.innerHTML = categories.map(cat => `
        <div class="category-card ${currentFilter === cat ? 'active' : ''}" data-category="${cat}">
          <div class="category-icon">${categoryIcons[cat]}</div>
          <div class="category-name">${cat}</div>
          <div class="category-amount">‚Çπ${categoryTotals[cat].toFixed(0)}</div>
        </div>
      `).join('');
    }

    function filterByCategory(category) {
      document.getElementById('filterCategory').value = category;
      currentFilter = category;
      renderExpenses();
      renderCategories();
    }

    function showAddExpenseModal() {
      document.getElementById('addExpenseModal').classList.add('show');
      setTimeout(() => document.getElementById('inputAmount').focus(), 100);
    }

    function closeAddExpenseModal() {
      document.getElementById('addExpenseModal').classList.remove('show');
      document.getElementById('expenseForm').reset();
      document.getElementById('inputDate').valueAsDate = new Date();
      toggleCustomCategory();
      toggleTransactionId();
    }

    function toggleCustomCategory() {
      const category = document.getElementById('inputCategory').value;
      const customGroup = document.getElementById('customCategoryGroup');
      const customInput = document.getElementById('inputCustomCategory');
      
      if (category === 'Other') {
        customGroup.classList.remove('hidden');
        customInput.required = true;
      } else {
        customGroup.classList.add('hidden');
        customInput.required = false;
      }
    }

    function toggleTransactionId() {
      const paymentMethod = document.getElementById('inputPaymentMethod').value;
      const transactionGroup = document.getElementById('transactionIdGroup');
      
      if (paymentMethod === 'Cash') {
        transactionGroup.classList.add('hidden');
      } else {
        transactionGroup.classList.remove('hidden');
      }
    }

    function addExpense(event) {
      event.preventDefault();
      
      const category = document.getElementById('inputCategory').value;
      const finalCategory = category === 'Other' 
        ? document.getElementById('inputCustomCategory').value 
        : category;

      const expense = {
        id: Date.now(),
        amount: parseFloat(document.getElementById('inputAmount').value),
        category: finalCategory,
        date: document.getElementById('inputDate').value,
        description: document.getElementById('inputDescription').value,
        paymentMethod: document.getElementById('inputPaymentMethod').value,
        transactionId: document.getElementById('inputTransactionId').value
      };

      expenses.unshift(expense);
      localStorage.setItem('expenses', JSON.stringify(expenses));
      renderExpenses();
      renderCategories();
      closeAddExpenseModal();
    }

    function deleteExpense(id) {
      if (confirm('Delete this expense?')) {
        expenses = expenses.filter(e => e.id !== id);
        localStorage.setItem('expenses', JSON.stringify(expenses));
        renderExpenses();
        renderCategories();
      }
    }

    function filterExpenses() {
      currentFilter = document.getElementById('filterCategory').value;
      renderExpenses();
      renderCategories();
    }

    function renderExpenses() {
      const filtered = currentFilter === 'All' 
        ? expenses 
        : expenses.filter(e => e.category === currentFilter);

      const total = filtered.reduce((sum, e) => sum + e.amount, 0);
      document.getElementById('totalAmount').textContent = `‚Çπ${total.toFixed(2)}`;

      const list = document.getElementById('expensesList');
      
      if (filtered.length === 0) {
        list.innerHTML = '<div class="no-expenses"><p>No expenses yet</p><p>Add your first expense!</p></div>';
        return;
      }

      list.innerHTML = filtered.map(expense => `
        <div class="expense-item">
          <div class="expense-header">
            <div>
              <span class="expense-amount">‚Çπ${expense.amount.toFixed(2)}</span>
              <span class="expense-category">${expense.category}</span>
            </div>
            <button class="delete-btn" data-id="${expense.id}">üóëÔ∏è</button>
          </div>
          <div class="expense-desc">${expense.description}</div>
          <div class="expense-meta">
            üìÖ ${new Date(expense.date).toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' })}
          </div>
          <div class="expense-meta">
            üí≥ ${expense.paymentMethod}
            ${expense.transactionId ? ` ‚Ä¢ TXN: ${expense.transactionId}` : ''}
          </div>
        </div>
      `).join('');
    }

    function exportToExcel() {
      if (expenses.length === 0) {
        alert('No expenses to export!');
        return;
      }

      const header = userProfile.name 
        ? [`Expense Report for: ${userProfile.name}`, '', '']
        : [];
      
      const csvContent = [
        ...header,
        ['Date', 'Description', 'Category', 'Amount (‚Çπ)', 'Payment Method', 'Transaction ID'],
        ...expenses.map(exp => [
          exp.date,
          exp.description,
          exp.category,
          exp.amount.toFixed(2),
          exp.paymentMethod,
          exp.transactionId || 'N/A'
        ])
      ].map(row => Array.isArray(row) ? row.join(',') : row).join('\n');

      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `expenses_${new Date().toISOString().split('T')[0]}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    init();
  </script>
</body>
</html>